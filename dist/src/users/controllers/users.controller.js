"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const argon2_1=__importDefault(require("argon2")),crypto_1=__importDefault(require("crypto")),debug_util_1=__importDefault(require("../../utils/debug.util")),users_service_1=__importDefault(require("../services/users.service")),log=(0,debug_util_1.default)("app:users-controller");class UsersController{async post(e,s){const t=crypto_1.default.createSecretKey(crypto_1.default.randomBytes(16)).export().toString("hex"),a=`${btoa(e.body.password)}${t}`;e.body.password=await argon2_1.default.hash(a),e.body.password=`${e.body.password}.$.${t}`;const r=await users_service_1.default.create(e.body);s.status(201).send({id:r})}async getList(e,s){const{limit:t=100,page:a=0}=e.query,r=await users_service_1.default.list(t,a);s.status(200).send(r)}async getById(e,s){const t=await users_service_1.default.readById(e.body.id);s.status(200).send(t)}async getByEmail(e,s){const t=await users_service_1.default.readByEmail(e.params.email);s.status(200).send(t)}async putById(e,s){const t=crypto_1.default.createSecretKey(crypto_1.default.randomBytes(16)).export().toString("hex"),a=`${btoa(e.body.password)}${t}`;e.body.password=await argon2_1.default.hash(a),e.body.password=`${e.body.password}.$.${t}`,log(await users_service_1.default.partialUpdateById(e.body.id,e.body)),s.status(204).send({id:e.body.id})}async updatePermissionFlag(e,s){const t={permissionFlag:parseInt(e.params.permissionFlag,10)};log(await users_service_1.default.partialUpdateById(e.body.id,t)),s.status(204).send()}async patchById(e,s){if(e.body.password){const s=crypto_1.default.createSecretKey(crypto_1.default.randomBytes(16)).export().toString("hex"),t=`${btoa(e.body.password)}${s}`;e.body.password=await argon2_1.default.hash(t),e.body.password=`${e.body.password}.$.${s}`}log(await users_service_1.default.partialUpdateById(e.body.id,e.body)),s.status(204).send()}async deleteById(e,s){log(await users_service_1.default.deleteById(e.body.id)),s.status(204).send()}}exports.default=new UsersController;