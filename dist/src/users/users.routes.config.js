"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const express_validator_1=require("express-validator"),common_routes_config_1=__importDefault(require("../common/common.routes.config")),users_controller_1=__importDefault(require("./controllers/users.controller")),users_middleware_1=__importDefault(require("./middleware/users.middleware")),body_validation_middleware_1=__importDefault(require("../common/middleware/body.validation.middleware")),jwt_middleware_1=__importDefault(require("../auth/middleware/jwt.middleware")),common_permissions_middleware_1=__importDefault(require("../common/middleware/common.permissions.middleware")),common_permission_flag_enum_1=__importDefault(require("../common/middleware/common.permission.flag.enum"));class UsersRoute extends common_routes_config_1.default{constructor(e){super(e,"UsersRoute")}configureRoutes(){return this.app.route("/users").get(jwt_middleware_1.default.validJwtNeeded,common_permissions_middleware_1.default.permissionFlagRequired(common_permission_flag_enum_1.default.ADMIN_PERMISSION),users_controller_1.default.getList).post((0,express_validator_1.body)("email").isEmail(),(0,express_validator_1.body)("password").isLength({min:5}).withMessage("Must include password (5+ characters)"),(0,express_validator_1.body)("firstName").isString().optional(),(0,express_validator_1.body)("lastName").isString().optional(),(0,express_validator_1.body)("permissionFlag").isInt().optional(),body_validation_middleware_1.default.verifyBodyFieldsErrors,users_middleware_1.default.validateEmailDoesNotExist,users_controller_1.default.post),this.app.param("userId",users_middleware_1.default.extractParamUserId),this.app.route("/users/:userId").all(users_middleware_1.default.validateUserExists,jwt_middleware_1.default.validJwtNeeded,common_permissions_middleware_1.default.onlySameUserOrAdminCanDoThisAction).get(users_controller_1.default.getById).delete(users_controller_1.default.deleteById),this.app.put("/users/:userId",[(0,express_validator_1.body)("email").isEmail(),(0,express_validator_1.body)("password").isLength({min:5}).withMessage("Must include password (5+ characters)"),(0,express_validator_1.body)("firstName").isString(),(0,express_validator_1.body)("lastName").isString(),(0,express_validator_1.body)("permissionFlag").isInt(),body_validation_middleware_1.default.verifyBodyFieldsErrors,users_middleware_1.default.validateEmailBelongsToUser,users_middleware_1.default.userCannotChangePermission,common_permissions_middleware_1.default.permissionFlagRequired(common_permission_flag_enum_1.default.PAID_PERMISSION),users_controller_1.default.putById]),this.app.put("/users/:userId/permissionFlag/:permissionFlag",[jwt_middleware_1.default.validJwtNeeded,common_permissions_middleware_1.default.onlySameUserOrAdminCanDoThisAction,common_permissions_middleware_1.default.permissionFlagRequired(common_permission_flag_enum_1.default.FREE_PERMISSION),users_controller_1.default.updatePermissionFlag]),this.app.patch("/users/:userId",[(0,express_validator_1.body)("email").isEmail(),(0,express_validator_1.body)("password").isLength({min:5}).withMessage("Password must be 5+ characters").optional(),(0,express_validator_1.body)("firstName").isString().optional(),(0,express_validator_1.body)("lastName").isString().optional(),(0,express_validator_1.body)("permissionFlag").isInt().optional(),body_validation_middleware_1.default.verifyBodyFieldsErrors,users_middleware_1.default.validatePatchEmail,users_middleware_1.default.userCannotChangePermission,common_permissions_middleware_1.default.permissionFlagRequired(common_permission_flag_enum_1.default.PAID_PERMISSION),users_controller_1.default.patchById]),this.app}}exports.default=UsersRoute;