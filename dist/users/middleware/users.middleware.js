"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const debug_1=__importDefault(require("debug")),users_service_1=__importDefault(require("../services/users.service")),log=(0,debug_1.default)("app:users-controller");class UsersMiddleware{constructor(){this.validatePatchEmail=this.validatePatchEmail.bind(this)}async validateUserBodyFields(e,s,a){e.body||e.body.email||e.body.password?a():s.status(400).send({error:"Missing required fields email and password"})}async validateEmailDoesNotExist(e,s,a){await users_service_1.default.readByEmail(e.body.email)?s.status(400).send({error:"User email already exists"}):a()}async validateEmailBelongsToUser(e,s,a){const r=await users_service_1.default.readByEmail(e.body.email);r&&r.id===e.params.userId?a():s.status(400).send({error:"Invalid email"})}async validatePatchEmail(e,s,a){e.body.email?(log("Validating email",e.body.email),this.validateEmailBelongsToUser(e,s,a)):s.status(400).send({error:"Invalid email"})}async validateUserExists(e,s,a){users_service_1.default.readById(e.params.userId)?a():s.status(404).send({error:`User ${e.params.userId} not found`})}async extractParamUserId(e,s,a){e.body.id=e.params.userId,a()}}exports.default=new UsersMiddleware;