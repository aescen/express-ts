"use strict";var _UsersDao_instances,_UsersDao_allowedPatchedFields,_UsersDao_getPatchedUser,__classPrivateFieldGet=this&&this.__classPrivateFieldGet||function(e,s,t,a){if("a"===t&&!a)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof s?e!==s||!a:!s.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===t?a:"a"===t?a.call(e):a?a.value:s.get(e)},__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const shortid_1=__importDefault(require("shortid")),debug_util_1=__importDefault(require("../../utils/debug.util")),users_model_1=__importDefault(require("../models/users.model")),common_permission_flag_enum_1=__importDefault(require("../../common/middleware/common.permission.flag.enum")),log=(0,debug_util_1.default)("app:mongodb-dao");class UsersDao{constructor(){_UsersDao_instances.add(this),_UsersDao_allowedPatchedFields.set(this,["password","firstName","lastName","permissionFlag"]),log("created a new instance of UsersDao")}async addUser(e){const s=shortid_1.default.generate(),t=new users_model_1.default({_id:s,...e,permissionFlag:common_permission_flag_enum_1.default.FREE_PERMISSION});return await t.save(),s}async getUsers(e=25,s=0){return users_model_1.default.find().limit(e).skip(e*s).exec()}async getUserById(e){return users_model_1.default.findOne({_id:e}).exec()}async getUserByEmail(e){return users_model_1.default.findOne({email:e}).exec()}async getUserByEmailWithPassword(e){return users_model_1.default.findOne({email:e}).select("_id email permissionFlag +password").exec()}async updateUserById(e,s){return users_model_1.default.findOneAndUpdate({_id:e},{$set:s},{new:!0})}async deleteUserByUserId(e){return users_model_1.default.deleteOne({_id:e}).exec()}}_UsersDao_allowedPatchedFields=new WeakMap,_UsersDao_instances=new WeakSet,_UsersDao_getPatchedUser=function(e,s){for(let t=0;t<__classPrivateFieldGet(this,_UsersDao_allowedPatchedFields,"f").length;t+=1){const a=__classPrivateFieldGet(this,_UsersDao_allowedPatchedFields,"f")[t];a in s&&(e[a]=s[a])}return e},exports.default=new UsersDao;